From: "Igor B. Poretsky" <poretsky@mlbox.ru>
Date: Thu, 10 Nov 2022 23:05:07 +0300
Subject: Enhanced rpm support

---
 lisp/emacspeak-rpm.el | 40 +++++++++++++++++++++++++++++++++-------
 lisp/emacspeak.el     |  1 +
 2 files changed, 34 insertions(+), 7 deletions(-)

diff --git a/lisp/emacspeak-rpm.el b/lisp/emacspeak-rpm.el
index 2027f9c..5e153b7 100644
--- a/lisp/emacspeak-rpm.el
+++ b/lisp/emacspeak-rpm.el
@@ -69,16 +69,30 @@
   (when (ems-interactive-p)
     (message "Inverted sort order")
     (emacspeak-auditory-icon 'task-done)))
+(defadvice rpm-toggle-format (after emacspeak pre act comp)
+  "Provide auditory feedback."
+  (when (ems-interactive-p)
+    (emacspeak-auditory-icon 'task-done)))
 (defadvice rpm-mark (after emacspeak pre act comp)
   "Provide speech feedback."
   (when (ems-interactive-p)
-    (message "marked")
+    (emacspeak-speak-line)
     (emacspeak-auditory-icon 'mark-object)))
 (defadvice rpm-mark-delete (after emacspeak pre act comp)
   "Provide speech feedback."
   (when (ems-interactive-p)
-    (message "marked for deletion")
+    (emacspeak-speak-line)
     (emacspeak-auditory-icon 'mark-object)))
+(defadvice rpm-unmark (after emacspeak pre act comp)
+  "Provide speech feedback."
+  (when (ems-interactive-p)
+    (emacspeak-speak-line)
+    (emacspeak-auditory-icon 'deselect-object)))
+
+(defadvice rpm-requires (after emacspeak pre act comp)
+  "Provide auditory feedback."
+  (when (ems-interactive-p)
+    (emacspeak-auditory-icon 'open-object)))
 
 (defadvice rpm-quit (after emacspeak pre act comp)
   "Provide speech feedback."
@@ -86,11 +100,23 @@
     (emacspeak-speak-mode-line)
     (emacspeak-auditory-icon 'close-object)))
 
-(defadvice rpm-rebuild- (after emacspeak pre act comp)
-  "Provide speech feedback."
-  (when (ems-interactive-p)
-    (message "Rebuilt index")
-    (emacspeak-auditory-icon 'task-done)))
+(cl-loop for f in
+      '(rpm-rebuild rpm-rebuild-index)
+      do
+      (eval
+       `(defadvice ,f (after emacspeak pre act comp)
+          "Provide speech feedback."
+          (when (ems-interactive-p)
+            (message "Rebuilt index")
+            (emacspeak-auditory-icon 'task-done)))))
+
+(defadvice rpm-proc-sentinel (after emacspeak pre act comp)
+  "Provide auditory feedback."
+  (emacspeak-auditory-icon 'task-done))
+
+(defadvice rpm-do-visit (after emacspeak pre act comp)
+  "Provide auditory feedback."
+  (emacspeak-auditory-icon 'open-object))
 
 ;;}}}
 ;;{{{ fix interactive commands 
diff --git a/lisp/emacspeak.el b/lisp/emacspeak.el
index 0febf36..66a1cac 100644
--- a/lisp/emacspeak.el
+++ b/lisp/emacspeak.el
@@ -289,6 +289,7 @@ that implements the speech-enabling extensions for `package' (a string)."
 (emacspeak-do-package-setup "rst" 'emacspeak-rst)
 (emacspeak-do-package-setup "related" 'emacspeak-related)
 (emacspeak-do-package-setup "rmail" 'emacspeak-rmail)
+(emacspeak-do-package-setup "rpm" 'emacspeak-rpm)
 (emacspeak-do-package-setup "rpm-spec-mode" 'emacspeak-rpm-spec)
 (emacspeak-do-package-setup "ruby-mode" 'emacspeak-ruby)
 (emacspeak-do-package-setup "sgml-mode" 'emacspeak-sgml-mode)
