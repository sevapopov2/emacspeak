From: "Igor B. Poretsky" <poretsky@mlbox.ru>
Date: Thu, 10 Nov 2022 08:56:50 +0300
Subject: Debian-el package support

---
 lisp/Makefile                 |   4 +
 lisp/emacspeak-apt-sources.el |   2 +-
 lisp/emacspeak-apt-utils.el   | 178 ++++++++++++++++++++++++++++++++++++++++++
 lisp/emacspeak-debian-bug.el  |  62 +++++++++++++++
 lisp/emacspeak.el             |   2 +
 5 files changed, 247 insertions(+), 1 deletion(-)
 create mode 100644 lisp/emacspeak-apt-utils.el
 create mode 100644 lisp/emacspeak-debian-bug.el

diff --git a/lisp/Makefile b/lisp/Makefile
index 50654d9..aaefbc7 100644
--- a/lisp/Makefile
+++ b/lisp/Makefile
@@ -96,6 +96,7 @@ emacspeak-amark.elc \
 emacspeak-analog.elc \
 emacspeak-ansi-color.elc \
 emacspeak-apt-sources.elc \
+emacspeak-apt-utils.elc \
 emacspeak-arc.elc \
 emacspeak-auctex.elc \
 emacspeak-autoload.el \
@@ -121,6 +122,7 @@ emacspeak-compile.elc \
 emacspeak-company.elc \
 emacspeak-cperl.elc \
 emacspeak-custom.elc \
+emacspeak-debian-bug.elc \
 emacspeak-dbus.elc \
 emacspeak-dictionary.elc \
 emacspeak-desktop.elc \
@@ -368,6 +370,7 @@ emacspeak-advice.elc: emacspeak-advice.el dtk-speak.elc voice-setup.elc
 emacspeak-analog.elc: emacspeak-analog.el dtk-speak.elc voice-setup.elc
 emacspeak-ansi-color.elc: emacspeak-ansi-color.el dtk-speak.elc voice-setup.elc
 emacspeak-apt-sources.elc: emacspeak-apt-sources.el dtk-speak.elc voice-setup.elc
+emacspeak-apt-utils.elc: emacspeak-apt-utils.el dtk-speak.elc voice-setup.elc
 emacspeak-arc.elc: emacspeak-arc.el dtk-speak.elc voice-setup.elc
 emacspeak-auctex.elc: emacspeak-auctex.el dtk-speak.elc voice-setup.elc
 emacspeak-autoload.elc: emacspeak-autoload.el
@@ -396,6 +399,7 @@ emacspeak-custom.elc: emacspeak-custom.el dtk-speak.elc voice-setup.elc
 emacspeak-cyclebuffer.elc: emacspeak-cyclebuffer.el dtk-speak.elc
 emacspeak-epub.elc: emacspeak-epub.el dtk-speak.elc voice-setup.elc
 emacspeak-dbus.elc: emacspeak-dbus.el dtk-speak.elc nm.elc 
+emacspeak-debian-bug.elc: emacspeak-debian-bug.el dtk-speak.elc voice-setup.elc
 emacspeak-desktop.elc: emacspeak-desktop.el dtk-speak.elc voice-setup.elc
 emacspeak-dictionary.elc: emacspeak-dictionary.el dtk-speak.elc voice-setup.elc
 emacspeak-diff-mode.elc: emacspeak-diff-mode.el dtk-speak.elc voice-setup.elc
diff --git a/lisp/emacspeak-apt-sources.el b/lisp/emacspeak-apt-sources.el
index 840a031..b284222 100644
--- a/lisp/emacspeak-apt-sources.el
+++ b/lisp/emacspeak-apt-sources.el
@@ -15,7 +15,7 @@
 ;;{{{  Copyright:
 
 ;;; Initial version: Author: Igor B. Poretsky
-;;; <master@goga.energo.ru>
+;;; <poretsky@mlbox.ru>
 ;;; Updated and maintained by $Author: tv.raman.tv $
 ;;;
 ;;; This file is not part of GNU Emacs, but the same permissions apply.
diff --git a/lisp/emacspeak-apt-utils.el b/lisp/emacspeak-apt-utils.el
new file mode 100644
index 0000000..ca4accd
--- /dev/null
+++ b/lisp/emacspeak-apt-utils.el
@@ -0,0 +1,178 @@
+;;; emacspeak-apt-utils.el --- speech-enable APT interface  -*- lexical-binding: t; -*-
+;;; Description:  Emacspeak extension to speech-enable APT utilities
+;;; Keywords: Emacspeak, apt, Debian Package Manager
+;;{{{  LCD Archive entry:
+
+;;; LCD Archive Entry:
+;;; emacspeak| T. V. Raman |raman@cs.cornell.edu
+;;; A speech interface to Emacs |
+;;; $Date: 2007-08-25 18:28:19 -0700 (Sat, 25 Aug 2007) $ |
+;;;  $Revision: 4531 $ |
+;;; Location undetermined
+;;;
+
+;;}}}
+;;{{{  Copyright:
+
+;;; Initial version: Author: Igor B. Poretsky <poretsky@mlbox.ru>
+;;;
+;;; This file is not part of GNU Emacs, but the same permissions apply.
+;;;
+;;; GNU Emacs is free software; you can redistribute it and/or modify
+;;; it under the terms of the GNU General Public License as published by
+;;; the Free Software Foundation; either version 2, or (at your option)
+;;; any later version.
+;;;
+;;; GNU Emacs is distributed in the hope that it will be useful,
+;;; but WITHOUT ANY WARRANTY; without even the implied warranty of
+;;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+;;; GNU General Public License for more details.
+;;;
+;;; You should have received a copy of the GNU General Public License
+;;; along with GNU Emacs; see the file COPYING.  If not, write to
+;;; the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+
+;;}}}
+;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
+
+;;{{{  Introduction:
+
+;;; Commentary:
+
+;;; This module speech-enables apt-utils.el
+;;; that is included in the debian-el package
+;;; and provides a nice interface to searching and browsing
+;;; Debian packages.
+;;; Code:
+
+;;}}}
+;;{{{ required modules
+
+(require 'emacspeak-preamble)
+(require 'apt-utils ()  'no-error)
+;;}}}
+;;{{{ Forward declarations
+
+(declare-function apt-utils-package-at "ext:apt-utils.el" ())
+
+;;}}}
+;;{{{  Initial setup
+
+(defun emacspeak-apt-utils-grab-package-at-point ()
+  "Copy package under point to kill ring."
+  (interactive)
+  (unless (eq major-mode 'apt-utils-mode)
+    (error "Not in APT Info buffer."))
+  (let ((package (apt-utils-package-at)))
+    (emacspeak-auditory-icon 'yank-object)
+    (dtk-speak package)
+    (kill-new package)))
+
+(defsubst emacspeak-apt-utils-speak-package-name ()
+  "Speak package name at point."
+  (let ((package (apt-utils-package-at)))
+    (put-text-property 0 (length package)
+                       'personality (get-text-property (point) 'personality)
+                       package)
+    (dtk-speak package)))
+
+(defadvice apt-utils-mode (after emacspeak pre act comp)
+  "Setup Emacspeak extensions"
+  (dtk-set-punctuations 'all)
+  (define-key apt-utils-mode-map "y" 'emacspeak-apt-utils-grab-package-at-point))
+
+;;}}}
+;;{{{ Advice interactive commands to speak.
+
+(cl-loop for f in
+      '(apt-utils-search
+	apt-utils-search-names-only
+	apt-utils-search-grep-dctrl
+	apt-utils-search-file-names)
+      do
+      (eval
+       `(defadvice ,f (after emacspeak pre act comp)
+	  "Provide auditory feedback."
+	  (when (ems-interactive-p)
+	    (emacspeak-auditory-icon 'search-hit)))))
+
+(cl-loop for f in
+      '(apt-utils-quit
+	apt-utils-kill-buffer)
+      do
+      (eval
+       `(defadvice ,f (after emacspeak pre act comp)
+	  "Provide auditory feedback."
+	  (when (ems-interactive-p)
+	    (emacspeak-auditory-icon 'close-object)
+	    (emacspeak-speak-mode-line)))))
+
+(cl-loop for f in
+      '(apt-utils-rebuild-package-lists
+	apt-utils-toggle-package-info)
+      do
+      (eval
+       `(defadvice ,f (after emacspeak pre act comp)
+	  "Provide auditory feedback."
+	  (when (ems-interactive-p)
+	    (emacspeak-auditory-icon 'task-done)))))
+
+(cl-loop for f in
+      '(apt-utils-show-package
+	apt-utils-choose-package-link
+	apt-utils-view-previous-package
+	apt-utils-view-copyright
+	apt-utils-view-readme
+	apt-utils-view-debian-readme
+	apt-utils-view-news
+	apt-utils-view-debian-news
+	apt-utils-view-changelog
+	apt-utils-view-debian-changelog
+        apt-utils-list-package-files
+	apt-utils-follow-link)
+      do
+      (eval
+       `(defadvice ,f (after emacspeak pre act comp)
+	  "Provide auditory feedback."
+	  (when (ems-interactive-p)
+	    (emacspeak-auditory-icon 'open-object)))))
+
+(cl-loop for f in
+      '(apt-utils-previous-package
+	apt-utils-next-package)
+      do
+      (eval
+       `(defadvice ,f (around emacspeak pre act comp)
+	  "Provide auditory feedback."
+	  (if (ems-interactive-p)
+	      (let ((emacspeak-speak-messages nil))
+		ad-do-it
+		(emacspeak-auditory-icon 'large-movement)
+		(emacspeak-speak-text-range 'apt-package))
+	    ad-do-it)
+	  ad-return-value)))
+
+;;}}}
+;;{{{ mapping font faces to personalities
+
+(voice-setup-add-map
+ '(
+   (apt-utils-normal-package-face voice-bolden)
+   (apt-utils-virtual-package-face voice-animate)
+   (apt-utils-field-keyword-face voice-animate-extra)
+   (apt-utils-field-contents-face voice-lighten-extra)
+   (apt-utils-description-face voice-smoothen-extra)
+   (apt-utils-version-face voice-lighten)
+   (apt-utils-broken-face voice-bolden-and-animate)
+   ))
+
+;;}}}
+(provide 'emacspeak-apt-utils)
+;;{{{ end of file
+
+;;; local variables:
+;;; folded-file: t
+;;; byte-compile-dynamic: t
+;;; end:
+
+;;}}}
diff --git a/lisp/emacspeak-debian-bug.el b/lisp/emacspeak-debian-bug.el
new file mode 100644
index 0000000..e63148f
--- /dev/null
+++ b/lisp/emacspeak-debian-bug.el
@@ -0,0 +1,62 @@
+;;; emacspeak-debian-bug.el --- speech-enable Debian bug reports  -*- lexical-binding: t; -*-
+;;; Description:  Emacspeak extension to speech-enable bug reporting to the Debian bug tracking system
+;;; Keywords: Emacspeak, apt, Debian bug tracking system
+;;{{{  LCD Archive entry:
+
+;;}}}
+;;{{{  Copyright:
+
+;;; Initial version: Author: Igor B. Poretsky <poretsky@mlbox.ru>
+;;;
+;;; This file is not part of GNU Emacs, but the same permissions apply.
+;;;
+;;; GNU Emacs is free software; you can redistribute it and/or modify
+;;; it under the terms of the GNU General Public License as published by
+;;; the Free Software Foundation; either version 2, or (at your option)
+;;; any later version.
+;;;
+;;; GNU Emacs is distributed in the hope that it will be useful,
+;;; but WITHOUT ANY WARRANTY; without even the implied warranty of
+;;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+;;; GNU General Public License for more details.
+;;;
+;;; You should have received a copy of the GNU General Public License
+;;; along with GNU Emacs; see the file COPYING.  If not, write to
+;;; the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+
+;;}}}
+;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
+
+;;{{{  Introduction:
+
+;;; Commentary:
+
+;;; This module speech-enables debian-bug.el
+;;; that is included in the debian-el package
+;;; and provides convenient way to generate and submit bug reports
+;;; to the Debian bug tracking system.
+;;; Code:
+
+;;}}}
+;;{{{ required modules
+
+(require 'emacspeak-preamble)
+
+;;}}}
+;;{{{ Advice interactive commands to speak.
+
+(defadvice debian-bug (around emacspeak pre act comp)
+  "Provide speech feedback."
+  (let ((emacspeak-speak-messages t))
+    ad-do-it))
+
+;;}}}
+(provide 'emacspeak-debian-bug)
+;;{{{ end of file
+
+;;; local variables:
+;;; folded-file: t
+;;; byte-compile-dynamic: t
+;;; end:
+
+;;}}}
diff --git a/lisp/emacspeak.el b/lisp/emacspeak.el
index 2e5af53..75234d7 100644
--- a/lisp/emacspeak.el
+++ b/lisp/emacspeak.el
@@ -150,6 +150,7 @@ that implements the speech-enabling extensions for `package' (a string)."
 (emacspeak-do-package-setup "analog" 'emacspeak-analog)
 (emacspeak-do-package-setup "ansi-color" 'emacspeak-ansi-color)
 (emacspeak-do-package-setup "apt-sources" 'emacspeak-apt-sources)
+(emacspeak-do-package-setup "apt-utils" 'emacspeak-apt-utils)
 (emacspeak-do-package-setup "arc-mode" 'emacspeak-arc)
 (emacspeak-do-package-setup "bbdb" 'emacspeak-bbdb)
 (emacspeak-do-package-setup "bibtex" 'emacspeak-bibtex)
@@ -179,6 +180,7 @@ that implements the speech-enabling extensions for `package' (a string)."
 (emacspeak-do-package-setup "ecb" 'emacspeak-ecb)
 (emacspeak-do-package-setup "ein" 'emacspeak-ein)
 (emacspeak-do-package-setup "cus-edit" 'emacspeak-custom)
+(emacspeak-do-package-setup "debian-bug" 'emacspeak-debian-bug )
 (emacspeak-do-package-setup "desktop" 'emacspeak-desktop)
 (emacspeak-do-package-setup "diff-mode" 'emacspeak-diff-mode)
 (emacspeak-do-package-setup "dired" 'emacspeak-dired)
