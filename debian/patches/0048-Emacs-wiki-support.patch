From: "Igor B. Poretsky" <poretsky@mlbox.ru>
Date: Thu, 10 Nov 2022 11:16:45 +0300
Subject: Emacs wiki support

---
 lisp/Makefile          |   2 +
 lisp/emacspeak-wiki.el | 115 +++++++++++++++++++++++++++++++++++++++++++++++++
 lisp/emacspeak.el      |   1 +
 3 files changed, 118 insertions(+)
 create mode 100644 lisp/emacspeak-wiki.el

diff --git a/lisp/Makefile b/lisp/Makefile
index b4cde37..cc299fa 100644
--- a/lisp/Makefile
+++ b/lisp/Makefile
@@ -288,6 +288,7 @@ emacspeak-webspace.elc \
 emacspeak-webutils.elc \
 emacspeak-websearch.elc \
 emacspeak-widget.elc \
+emacspeak-wiki.elc \
 emacspeak-windmove.elc \
 emacspeak-winring.elc \
 emacspeak-woman.elc \
@@ -588,6 +589,7 @@ emacspeak-webspace.elc: emacspeak-webspace.el emacspeak-webutils.elc
 emacspeak-websearch.elc: emacspeak-websearch.el emacspeak-we.elc
 emacspeak-webmarks.elc: emacspeak-webmarks.el emacspeak-we.elc
 emacspeak-widget.elc: emacspeak-widget.el dtk-speak.elc voice-setup.elc
+emacspeak-wiki.elc: emacspeak-wiki.el dtk-speak.elc voice-setup.elc
 emacspeak-winring.elc: emacspeak-winring.el dtk-speak.elc voice-setup.elc
 emacspeak-woman.elc: emacspeak-woman.el dtk-speak.elc
 emacspeak-windmove.elc: emacspeak-windmove.el dtk-speak.elc voice-setup.elc
diff --git a/lisp/emacspeak-wiki.el b/lisp/emacspeak-wiki.el
new file mode 100644
index 0000000..0a708b9
--- /dev/null
+++ b/lisp/emacspeak-wiki.el
@@ -0,0 +1,115 @@
+;;; emacspeak-wiki.el --- speech-enable emacs-wiki  -*- lexical-binding: t; -*-
+;;; Description:  Emacspeak extension to speech-enable emacs-wiki package
+;;; Keywords: Emacspeak, Emacs wiki, html publishing
+;;{{{  LCD Archive entry:
+
+;;}}}
+;;{{{  Copyright:
+
+;;; Initial version: Author: Igor B. Poretsky <poretsky@mlbox.ru>
+;;;
+;;; This file is not part of GNU Emacs, but the same permissions apply.
+;;;
+;;; GNU Emacs is free software; you can redistribute it and/or modify
+;;; it under the terms of the GNU General Public License as published by
+;;; the Free Software Foundation; either version 2, or (at your option)
+;;; any later version.
+;;;
+;;; GNU Emacs is distributed in the hope that it will be useful,
+;;; but WITHOUT ANY WARRANTY; without even the implied warranty of
+;;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+;;; GNU General Public License for more details.
+;;;
+;;; You should have received a copy of the GNU General Public License
+;;; along with GNU Emacs; see the file COPYING.  If not, write to
+;;; the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+
+;;}}}
+;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
+
+;;{{{ required modules
+
+(require 'emacspeak-preamble)
+;;}}}
+;;{{{  Introduction:
+
+;;; Commentary:
+
+;;; This module speech-enables emacs-wiki package
+;;; that allows to construct hypertext documents
+;;; and publish it as html pages.
+
+;;}}}
+;;{{{ Advice interactive commands to speak.
+
+(defadvice emacs-wiki-find-file (around emacspeak pre act comp)
+  "Produce an auditory icon if possible."
+  (if (not (ems-interactive-p))
+      ad-do-it
+    (ad-set-arg 0 (car (ad-get-arg 0)))
+    ad-do-it
+    (emacspeak-auditory-icon 'open-object)
+    (emacspeak-speak-mode-line))
+  ad-return-value)
+
+(defadvice emacs-wiki-follow-name-at-point (after emacspeak pre act comp)
+  "Produce an auditory icon if possible."
+  (when (ems-interactive-p)
+    (emacspeak-auditory-icon 'open-object)
+    (emacspeak-speak-mode-line)))
+
+(defadvice emacs-wiki-index (after emacspeak pre act comp)
+  "Produce an auditory icon if possible."
+  (when (ems-interactive-p)
+    (emacspeak-auditory-icon 'open-object)
+    (emacspeak-speak-mode-line)))
+
+(defadvice emacs-wiki-next-reference (after emacspeak pre act comp)
+  "Provide speech feedback."
+  (when (ems-interactive-p)
+    (if (emacs-wiki-link-at-point)
+        (progn
+          (emacspeak-auditory-icon 'large-movement)
+          (emacspeak-speak-text-range 'keymap))
+      (emacspeak-auditory-icon 'warn-user)
+      (dtk-speak-and-echo "No links on this page"))))
+
+(defadvice emacs-wiki-previous-reference (after emacspeak pre act comp)
+  "Provide speech feedback."
+  (when (ems-interactive-p)
+    (if (emacs-wiki-link-at-point)
+        (progn
+          (emacspeak-auditory-icon 'large-movement)
+          (emacspeak-speak-text-range 'keymap))
+      (emacspeak-auditory-icon 'warn-user)
+      (dtk-speak-and-echo "No links on this page"))))
+
+(defadvice emacs-wiki-publish (after emacspeak pre act comp)
+  "Produce an auditory icon if possible."
+  (when (ems-interactive-p)
+    (emacspeak-auditory-icon 'save-object)))
+
+;;}}}
+;;{{{ mapping font faces to personalities 
+
+(voice-setup-add-map
+ '(
+   (emacs-wiki-link-face voice-bolden)
+   (emacs-wiki-bad-link-face voice-lighten)
+   (emacs-wiki-header-1-face voice-brighten)
+   (emacs-wiki-header-2-face voice-brighten)
+   (emacs-wiki-header-3-face voice-brighten)
+   (emacs-wiki-header-4-face voice-brighten)
+   (emacs-wiki-header-5-face voice-brighten)
+   (emacs-wiki-header-6-face voice-brighten)
+   ))
+
+;;}}}
+(provide 'emacspeak-wiki)
+;;{{{ end of file
+
+;;; local variables:
+;;; folded-file: t
+;;; end:
+
+;;}}}
diff --git a/lisp/emacspeak.el b/lisp/emacspeak.el
index 6f430ea..1fa8024 100644
--- a/lisp/emacspeak.el
+++ b/lisp/emacspeak.el
@@ -330,6 +330,7 @@ that implements the speech-enabling extensions for `package' (a string)."
 (emacspeak-do-package-setup "wdired" 'emacspeak-wdired)
 (emacspeak-do-package-setup "cus-edit" 'emacspeak-custom)
 (emacspeak-do-package-setup "wid-edit" 'emacspeak-widget)
+(emacspeak-do-package-setup "emacs-wiki" 'emacspeak-wiki)
 (emacspeak-do-package-setup "widget" 'emacspeak-widget)
 (emacspeak-do-package-setup "windmove" 'emacspeak-windmove)
 (emacspeak-do-package-setup "winring" 'emacspeak-winring)
