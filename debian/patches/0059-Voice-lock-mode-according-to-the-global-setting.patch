From: "Igor B. Poretsky" <poretsky@mlbox.ru>
Date: Tue, 22 Nov 2022 05:45:55 +0300
Subject: Voice lock mode according to the global setting

---
 lisp/emacspeak-bs.el       | 2 +-
 lisp/emacspeak-enriched.el | 5 +++--
 lisp/emacspeak-erc.el      | 3 +--
 lisp/emacspeak-ispell.el   | 2 +-
 lisp/emacspeak-speedbar.el | 7 ++++---
 5 files changed, 10 insertions(+), 9 deletions(-)

diff --git a/lisp/emacspeak-bs.el b/lisp/emacspeak-bs.el
index a203a6e..e7233c6 100644
--- a/lisp/emacspeak-bs.el
+++ b/lisp/emacspeak-bs.el
@@ -120,7 +120,7 @@
 
 (defadvice bs-mode (after emacspeak pre act comp)
   "Speech-enable bs mode"
-  (setq voice-lock-mode t))
+  (voice-lock-mode (if global-voice-lock-mode 1 -1)))
 
 (defadvice bs-kill (after emacspeak pre act comp)
   "Speech-enable bs mode"
diff --git a/lisp/emacspeak-enriched.el b/lisp/emacspeak-enriched.el
index f87f46c..8c77b06 100644
--- a/lisp/emacspeak-enriched.el
+++ b/lisp/emacspeak-enriched.el
@@ -56,8 +56,9 @@
   "Map base fonts to voices.
 Useful in voiceifying rich text."
   (interactive "r")
-  (cl-declare (special emacspeak-enriched-font-faces-to-voiceify))
-  (set (make-local-variable 'voice-lock-mode) t)
+  (cl-declare (special global-voice-lock-mode
+                    emacspeak-enriched-font-faces-to-voiceify))
+  (voice-lock-mode (if global-voice-lock-mode 1 -1))
   (with-silent-modifications
     (save-excursion
       (goto-char start)
diff --git a/lisp/emacspeak-erc.el b/lisp/emacspeak-erc.el
index f7c5824..7210f07 100644
--- a/lisp/emacspeak-erc.el
+++ b/lisp/emacspeak-erc.el
@@ -100,9 +100,8 @@ server."
 
 (defadvice erc-mode (after emacspeak pre act comp)
   "Turn on voice lock mode."
-  (cl-declare (special voice-lock-mode))
   (emacspeak-pronounce-refresh-pronunciations)
-  (setq voice-lock-mode t))
+  (voice-lock-mode (if global-voice-lock-mode 1 -1)))
 
 (defadvice erc-select (after emacspeak pre act comp)
   "Provide auditory feedback."
diff --git a/lisp/emacspeak-ispell.el b/lisp/emacspeak-ispell.el
index 1159a91..9e47150 100644
--- a/lisp/emacspeak-ispell.el
+++ b/lisp/emacspeak-ispell.el
@@ -90,7 +90,7 @@ many available corrections."
            start end voice-bolden
            (buffer-substring (line-beginning-position) (line-end-position))))
     (with-temp-buffer
-      (setq voice-lock-mode t)
+      (voice-lock-mode (if global-voice-lock-mode 1 -1))
       (setq buffer-undo-list t)
       (dtk-set-punctuations 'all)
       (insert line)
diff --git a/lisp/emacspeak-speedbar.el b/lisp/emacspeak-speedbar.el
index 64dab9a..a8dcc1d 100644
--- a/lisp/emacspeak-speedbar.el
+++ b/lisp/emacspeak-speedbar.el
@@ -75,7 +75,7 @@
                                         ;"Wrapper to force speedbar to work outside a windowing system. "
                                         ;(let ((spoofing-p (not window-system)))
                                         ;ad-do-it
-                                        ;     (setq voice-lock-mode t))
+                                        ;     (voice-lock-mode (if global-voice-lock-mode 1 -1)))
                                         ;   ad-return-value)
 
 ;;}}}
@@ -191,12 +191,13 @@ An automatically updating speedbar consumes resources.")
 (defun emacspeak-speedbar-goto-speedbar ()
   "Switch to the speedbar"
   (interactive)
-  (cl-declare (special emacspeak-speedbar-disable-updates))
+  (cl-declare (special emacspeak-speedbar-disable-updates
+                    global-voice-lock-mode))
   (unless (get-buffer " SPEEDBAR")
     (speedbar-frame-mode))
   (pop-to-buffer (get-buffer " SPEEDBAR"))
   (set-window-dedicated-p (selected-window) nil)
-  (setq voice-lock-mode t)
+  (voice-lock-mode (if global-voice-lock-mode 1 -1))
   (when emacspeak-speedbar-disable-updates 
     (speedbar-stealthy-updates)
     (speedbar-disable-update))
