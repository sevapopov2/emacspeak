From: "Igor B. Poretsky" <poretsky@mlbox.ru>
Date: Thu, 10 Nov 2022 09:06:02 +0300
Subject: Asm mode support

---
 lisp/Makefile         |  2 ++
 lisp/emacspeak-asm.el | 80 +++++++++++++++++++++++++++++++++++++++++++++++++++
 lisp/emacspeak.el     |  2 ++
 3 files changed, 84 insertions(+)
 create mode 100644 lisp/emacspeak-asm.el

diff --git a/lisp/Makefile b/lisp/Makefile
index 1cbd5cf..aa1fc45 100644
--- a/lisp/Makefile
+++ b/lisp/Makefile
@@ -98,6 +98,7 @@ emacspeak-ansi-color.elc \
 emacspeak-apt-sources.elc \
 emacspeak-apt-utils.elc \
 emacspeak-arc.elc \
+emacspeak-asm.elc \
 emacspeak-auctex.elc \
 emacspeak-autoload.el \
 emacspeak-bbc.elc \
@@ -372,6 +373,7 @@ emacspeak-ansi-color.elc: emacspeak-ansi-color.el dtk-speak.elc voice-setup.elc
 emacspeak-apt-sources.elc: emacspeak-apt-sources.el dtk-speak.elc voice-setup.elc
 emacspeak-apt-utils.elc: emacspeak-apt-utils.el dtk-speak.elc voice-setup.elc
 emacspeak-arc.elc: emacspeak-arc.el dtk-speak.elc voice-setup.elc
+emacspeak-asm.elc: emacspeak-asm.el dtk-speak.elc voice-setup.elc
 emacspeak-auctex.elc: emacspeak-auctex.el dtk-speak.elc voice-setup.elc
 emacspeak-autoload.elc: emacspeak-autoload.el
 emacspeak-bbc.elc: emacspeak-bbc.el dtk-speak.elc voice-setup.elc
diff --git a/lisp/emacspeak-asm.el b/lisp/emacspeak-asm.el
new file mode 100644
index 0000000..505dbb5
--- /dev/null
+++ b/lisp/emacspeak-asm.el
@@ -0,0 +1,80 @@
+;;; emacspeak-asm.el --- Speech enable Asm Mode  -*- lexical-binding: t; -*-
+;;; Author: Igor B. Poretsky <poretsky@mlbox.ru>
+;;; Description: Emacspeak extensions for asm-mode
+;;; Keywords: emacspeak, audio interface to emacs asm mode
+;;{{{  LCD Archive entry: 
+
+;;}}}
+;;{{{  Copyright:
+;;;Copyright (C) 2005, Igor B. Poretsky <poretsky@mlbox.ru>
+;;; All Rights Reserved. 
+;;;
+;;; This file is not part of GNU Emacs, but the same permissions apply.
+;;;
+;;; GNU Emacs is free software; you can redistribute it and/or modify
+;;; it under the terms of the GNU General Public License as published by
+;;; the Free Software Foundation; either version 2, or (at your option)
+;;; any later version.
+;;;
+;;; GNU Emacs is distributed in the hope that it will be useful,
+;;; but WITHOUT ANY WARRANTY; without even the implied warranty of
+;;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+;;; GNU General Public License for more details.
+;;;
+;;; You should have received a copy of the GNU General Public License
+;;; along with GNU Emacs; see the file COPYING.  If not, write to
+;;; the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+
+;;}}}
+
+;;{{{  Introduction:
+
+;;; Provide additional advice to asm-mode 
+
+;;}}}
+;;{{{ requires
+(require 'emacspeak-preamble)
+
+;;}}}
+;;{{{  Advice interactive functions:
+
+(defadvice asm-newline (around emacspeak pre act comp)
+  "Speak the previous line if line echo is on.
+See command \\[emacspeak-toggle-line-echo].
+Otherwise cue user to the line just created."
+  (cl-declare (special emacspeak-line-echo ))
+  (cond
+   ((ems-interactive-p)
+    (cond
+     (emacspeak-line-echo
+      (emacspeak-speak-line )
+      ad-do-it)
+     (t ad-do-it
+        (dtk-speak-using-voice voice-annotate
+                               (format
+                                "indent %s"
+                                (current-column)))
+        (dtk-force))))
+   (t ad-do-it))
+  ad-return-value)
+
+(cl-loop for f in
+      '(asm-colon asm-comment)
+      do
+      (eval
+       `(defadvice ,f (after emacspeak pre act comp)
+	  "Provide speech feedback"
+	  (when (ems-interactive-p)
+	    (emacspeak-speak-line)))))
+
+;;}}}
+
+(provide  'emacspeak-asm)
+;;{{{  emacs local variables 
+
+;;; local variables:
+;;; folded-file: t
+;;; byte-compile-dynamic: t
+;;; end: 
+
+;;}}}
diff --git a/lisp/emacspeak.el b/lisp/emacspeak.el
index 49804df..09417e0 100644
--- a/lisp/emacspeak.el
+++ b/lisp/emacspeak.el
@@ -152,6 +152,7 @@ that implements the speech-enabling extensions for `package' (a string)."
 (emacspeak-do-package-setup "apt-sources" 'emacspeak-apt-sources)
 (emacspeak-do-package-setup "apt-utils" 'emacspeak-apt-utils)
 (emacspeak-do-package-setup "arc-mode" 'emacspeak-arc)
+(emacspeak-do-package-setup "asm-mode" 'emacspeak-asm)
 (emacspeak-do-package-setup "bbdb" 'emacspeak-bbdb)
 (emacspeak-do-package-setup "bibtex" 'emacspeak-bibtex)
 (emacspeak-do-package-setup "bookmark" 'emacspeak-bookmark)
@@ -407,6 +408,7 @@ caps."
    #'(lambda (hook)
        (add-hook hook #'emacspeak-setup-programming-mode))
    '(
+     asm-mode-hook
      conf-unix-mode-hook html-helper-mode-hook
      markdown-mode-hook muse-mode-hook
      sgml-mode-hook xml-mode-hook nxml-mode-hook xsl-mode-hook
