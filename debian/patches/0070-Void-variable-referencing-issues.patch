From: "Igor B. Poretsky" <poretsky@rakurs.com>
Date: Tue, 29 Nov 2022 12:05:15 +0300
Subject: Void variable referencing issues

---
 lisp/emacspeak-eww.el     | 2 +-
 lisp/emacspeak-hydra.el   | 1 +
 lisp/emacspeak-jabber.el  | 1 +
 lisp/emacspeak-mines.el   | 4 ++--
 lisp/emacspeak-paradox.el | 3 ++-
 lisp/emacspeak-popup.el   | 3 ++-
 lisp/emacspeak-vdiff.el   | 2 +-
 7 files changed, 10 insertions(+), 6 deletions(-)

diff --git a/lisp/emacspeak-eww.el b/lisp/emacspeak-eww.el
index c9fc6b1..83686b5 100644
--- a/lisp/emacspeak-eww.el
+++ b/lisp/emacspeak-eww.el
@@ -1853,7 +1853,7 @@ Warning, this is fragile, and depends on a stable id for the
 (defun  emacspeak-eww-update-title  (title)
   "Interactively set title --- renames buffer, and sets header-line."
   (interactive "sTitle:")
-  (cl-declare (special header-line-format))
+  (cl-declare (special header-line-format eww-data))
   (rename-buffer title  'unique)
   (setq header-line-format title)
   (plist-put eww-data :title title)
diff --git a/lisp/emacspeak-hydra.el b/lisp/emacspeak-hydra.el
index 4559bf4..1625f35 100644
--- a/lisp/emacspeak-hydra.el
+++ b/lisp/emacspeak-hydra.el
@@ -95,6 +95,7 @@ Also turn on hydra-is-helpful if it was turned off."
 
 ;;; We use plain messages:
 
+(cl-declaim (special hydra-head-format hydra-hint-display-type))
 (setq hydra-head-format "%s "
       hydra-hint-display-type nil
       hydra-hint-display-type #'message)
diff --git a/lisp/emacspeak-jabber.el b/lisp/emacspeak-jabber.el
index 78fda5b..1b4a25b 100644
--- a/lisp/emacspeak-jabber.el
+++ b/lisp/emacspeak-jabber.el
@@ -294,6 +294,7 @@ the kill ring as well."
 (defun emacspeak-jabber-speak-recent-message ()
   "Speak most recent message if one exists."
   (interactive)
+  (cl-declare (special jabber-activity-jids))
   (cond
    (jabber-activity-jids
     (save-excursion
diff --git a/lisp/emacspeak-mines.el b/lisp/emacspeak-mines.el
index d5617f1..ee0acf2 100644
--- a/lisp/emacspeak-mines.el
+++ b/lisp/emacspeak-mines.el
@@ -94,7 +94,7 @@
 (defun emacspeak-mines-speak-uncovered-count ()
   "Speak number of uncovered cells."
   (interactive)
-  (cl-declare (special mines-state))
+  (cl-declare (special mines-state mines-number-mines))
   (dtk-speak
    (format "%d mines with %d uncovered cells remaining."
            mines-number-mines (cl-count-if #'null mines-state))))
@@ -130,7 +130,7 @@ to beginning of board before searching."
 (defun emacspeak-mines-speak-board ()
   "Speak the board."
   (interactive)
-  (cl-declare (special  mines-number-cols))
+  (cl-declare (special  mines-number-cols mines-grid))
   (let ((cells nil))
     (save-excursion
       (setq cells
diff --git a/lisp/emacspeak-paradox.el b/lisp/emacspeak-paradox.el
index d893e4c..1d455f1 100644
--- a/lisp/emacspeak-paradox.el
+++ b/lisp/emacspeak-paradox.el
@@ -96,7 +96,8 @@
 
 (defun emacspeak-paradox-mode-hook ()
   "Emacspeak setup hook for paradox-mode."
-  (define-key paradox-menu-mode-map " " 'emacspeak-paradox-summarize-line)
+  (when (boundp 'paradox-menu-mode-map)
+    (define-key paradox-menu-mode-map " " 'emacspeak-paradox-summarize-line))
   (emacspeak-pronounce-add-buffer-local-dictionary-entry
    emacspeak-pronounce-date-yyyymmdd-pattern
    (cons 're-search-forward 'emacspeak-pronounce-yyyymmdd-date))
diff --git a/lisp/emacspeak-popup.el b/lisp/emacspeak-popup.el
index 18e56ab..f3a8a20 100644
--- a/lisp/emacspeak-popup.el
+++ b/lisp/emacspeak-popup.el
@@ -123,7 +123,8 @@
 
 (eval-after-load
     "popup"
-  `(define-key popup-menu-keymap   emacspeak-prefix 'emacspeak-prefix-command))
+  `(when (boundp 'popup-menu-keymap)
+     (define-key popup-menu-keymap   emacspeak-prefix 'emacspeak-prefix-command)))
 
 ;;}}}
 
diff --git a/lisp/emacspeak-vdiff.el b/lisp/emacspeak-vdiff.el
index 41bd0c3..aba8630 100644
--- a/lisp/emacspeak-vdiff.el
+++ b/lisp/emacspeak-vdiff.el
@@ -201,7 +201,7 @@
 ;;{{{ Setup:
 (eval-after-load
     "vdiff"
-  `(progn
+  `(when (boundp 'vdiff-mode-prefix-map)
      (define-key vdiff-mode-prefix-map   " " 'emacspeak-vdiff-speak-this-hunk)
      (define-key vdiff-mode-prefix-map   (kbd "C-SPC") 'emacspeak-vdiff-speak-other-hunk)
      (define-key vdiff-mode-prefix-map   (kbd "l") 'emacspeak-vdiff-speak-other-line)))
